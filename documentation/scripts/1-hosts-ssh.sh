#!/bin/bash

# Run this script in both VMs

source ./config.sh || { eko RED "config.sh not found."; }

# Add hostnames to /etc/hosts
eko CYAN "Adding hostnames to /etc/hosts"
echo -e "127.0.0.1      localhost\n$MASTER_IP   o-master\n$WORKER_IP    o-worker\n" | sudo tee /etc/hosts > /dev/null

eko CYAN "adding ssh keys"
eko YELLOW "For simplicity, we use the same pre generated keys for ssh between all nodes"
# private key
echo "-----BEGIN OPENSSH PRIVATE KEY-----
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
n6z+WYCRipl7AAAACnRAby1tYXN0ZXI=
-----END OPENSSH PRIVATE KEY-----" > ~/.ssh/id_rsa
# public key
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDTUo+gqYtnTLbUmH5wK5y03MdpAs7HKe/RR2JX5buDOBBHy0YCBD3fsoQNdeh2ilfS9Xxi5oqGTVlITEBr4NfTVkjlFPR+mI5OSaYeSyowmsVwV+jU7GAiwOQ6fbJDwjuO8aOX6BtSuXpsqvafUfAX0MUneiJBWH7v/sjTTMlk/qvmOevS+qwyAaXk02mwrVDecZfuAJI7Rt7VnUNZwwD9bnuOLD1Q3JPqw6qtzOLYxkNDmoieuBkYfc5YLd7nBz8V8yUy2X5RqL/H6d1iu1blLNPTYxwBhku8xHJlNQ0Wtd5w0NaojUN7Ygjv/Yw19RZrUgxNixQZt19GNynpkQm++hvQeQR9YR+hud9tpCB1ccVqADiHTYqpcuIWBZcOnHORYmItOyIRWlxEzZd0pMkGdO0AjsS0GC1TjFhcdmgbqwkQuo9XLI/UeRPciI6qmIEA1xfbNhxuBCsSZt79GPuT2/sZOFCyl8QYdSadNAqEh7nIwivYw+cudDLmTkurv+zU9Whzv9+7IfVn2eGjC5lhxeSGoR6RwFDVz7mDK6aAedh22Chk4caLz4JBhlnYam1mDoi12TeY+ILAGTUNTQzw0QVyV6llkP+hlTWKmrnUcnaZ3F1wCwa+nIMWQ9TyGQcLryKoW03l0UDKeqjXNm6aq9/XqSez+4wTX9D3dulmAw==" > ~/.ssh/id_rsa.pub
# add (pub) key to authorized_keys
cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

chmod 600 ~/.ssh/id_rsa
